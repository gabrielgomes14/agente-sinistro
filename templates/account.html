<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login Moderno SaaS</title>
<link rel="stylesheet" href="account-style.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { 
    getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged,
    signInWithEmailAndPassword, createUserWithEmailAndPassword,
    setPersistence, browserLocalPersistence, browserSessionPersistence
} from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyB7e1IpR2l0wvxPE0vdkUGXO6PT74cKSu4",
    authDomain: "ecar-agente.firebaseapp.com",
    projectId: "ecar-agente",
    storageBucket: "ecar-agente.appspot.com",
    messagingSenderId: "894019220547",
    appId: "1:894019220547:web:af042385f29544e2a810f6",
    measurementId: "G-1J4W027QZM"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// Expor funções no objeto window
window.auth = auth;
window.GoogleAuthProvider = GoogleAuthProvider;
window.signInWithPopup = signInWithPopup;
window.signInWithEmailAndPassword = signInWithEmailAndPassword;
window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
window.setPersistence = setPersistence;
window.browserLocalPersistence = browserLocalPersistence;
window.browserSessionPersistence = browserSessionPersistence;

// Redireciona se já estiver logado
onAuthStateChanged(auth, (user) => {
    if(user) window.location.href = 'index.html';
});
</script>

<style>
/* Toast notification */
.toast {
    visibility: hidden;
    min-width: 250px;
    margin-left: -125px;
    background-color: #4BB543;
    color: white;
    text-align: center;
    border-radius: 4px;
    padding: 16px;
    position: fixed;
    z-index: 9999;
    left: 50%;
    bottom: 30px;
    font-size: 16px;
    opacity: 0;
    transition: opacity 0.5s, bottom 0.5s;
}
.toast.show {
    visibility: visible;
    opacity: 1;
    bottom: 50px;
}
</style>
</head>
<body>

<div class="login-container">
    <div class="login-card">
        <div class="login-header">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none"><rect width="32" height="32" rx="6" fill="#635BFF"/><path d="M8 12h16v2H8v-2zm0 4h16v2H8v-2zm0 4h10v2H8v-2z" fill="white"/></svg>
            </div>
            <h1 id="form-title">Bem-vindo!</h1>
            <p id="form-subtitle">Faça o login para continuar</p>
        </div>
        
        <form class="login-form" id="loginForm" novalidate>
            <div class="input-group">
                <input type="email" id="email" name="email" required autocomplete="email" placeholder=" ">
                <label for="email">Endereço de e-mail</label>
                <span class="input-border"></span>
            </div>
            <div class="input-group">
                <input type="password" id="password" name="password" required autocomplete="current-password" placeholder=" ">
                <label for="password">Senha</label>
                <button type="button" class="password-toggle" id="passwordToggle" aria-label="Toggle password visibility">
                    <svg class="eye-icon" width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 3C4.5 3 1.6 5.6 1 8c.6 2.4 3.5 5 7 5s6.4-2.6 7-5c-.6-2.4-3.5-5-7-5zm0 8.5A3.5 3.5 0 118 4.5a3.5 3.5 0 010 7zm0-5.5a2 2 0 100 4 2 2 0 000-4z" fill="currentColor"/></svg>
                </button>
                <span class="input-border"></span>
            </div>
            
            <span class="error-message" id="formError"></span>

            <div class="form-options">
                <label class="checkbox-container">
                    <input type="checkbox" id="remember" name="remember">
                    <span class="checkmark"><svg width="10" height="8" viewBox="0 0 10 8" fill="none"><path d="M1 4l2.5 2.5L9 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                    Lembrar-me
                </label>
                <a href="#" class="forgot-link">Esqueceu a sua senha?</a>
            </div>
            <button type="submit" class="submit-btn" id="submit-button">
                <span class="btn-text" id="submit-button-text">Entrar</span>
            </button>
        </form>

        <div class="divider"><span>ou continue com</span></div>

        <div class="social-buttons">
            <button type="button" class="social-btn" id="google-signin-btn">
                Google
            </button>
        </div>
        
        <div class="signup-link">
            <span id="toggle-text">Não tem uma conta? </span>
            <a href="#" id="toggle-link">Crie uma agora</a>
        </div>
    </div>
</div>

<!-- Toast notification -->
<div id="toast" class="toast"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const loginForm = document.getElementById('loginForm');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const passwordToggle = document.getElementById('passwordToggle');
    const rememberCheckbox = document.getElementById('remember');
    const formError = document.getElementById('formError');
    const googleSignInBtn = document.getElementById('google-signin-btn');
    const toggleLink = document.getElementById('toggle-link');
    const toggleText = document.getElementById('toggle-text');
    const formTitle = document.getElementById('form-title');
    const formSubtitle = document.getElementById('form-subtitle');
    const submitButtonText = document.getElementById('submit-button-text');
    
    let isSignUpMode = false;

    function showToast(message, duration = 3000) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = "toast show";
        setTimeout(() => {
            toast.className = toast.className.replace("show", "");
        }, duration);
    }

    passwordToggle.addEventListener('click', () => {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        passwordToggle.style.color = type === 'text' ? '#635BFF' : '#8792a2';
    });

    toggleLink.addEventListener('click', (e) => {
        e.preventDefault();
        isSignUpMode = !isSignUpMode;
        formError.textContent = '';
        if(isSignUpMode){
            formTitle.textContent = 'Crie a sua Conta';
            formSubtitle.textContent = 'É rápido e fácil!';
            submitButtonText.textContent = 'Cadastrar';
            toggleText.textContent = 'Já tem uma conta? ';
            toggleLink.textContent = 'Entrar agora';
        } else {
            formTitle.textContent = 'Bem-vindo!';
            formSubtitle.textContent = 'Faça o login para continuar';
            submitButtonText.textContent = 'Entrar';
            toggleText.textContent = 'Não tem uma conta? ';
            toggleLink.textContent = 'Crie uma agora';
        }
    });

    googleSignInBtn.addEventListener('click', async () => {
        try {
            const persistence = rememberCheckbox.checked ? window.browserLocalPersistence : window.browserSessionPersistence;
            await window.setPersistence(window.auth, persistence);

            const provider = new window.GoogleAuthProvider();
            await window.signInWithPopup(window.auth, provider);

            showToast("Login com Google realizado com sucesso!", 2000);
            setTimeout(() => window.location.href = 'index.html', 2000);
        } catch(error){
            console.error(error);
            formError.textContent = `Erro com Google: ${error.message}`;
        }
    });

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = emailInput.value.trim().toLowerCase();
        const password = passwordInput.value.trim();
        formError.textContent = '';

        if(!email || !password){
            formError.textContent = 'Por favor, preencha todos os campos.';
            return;
        }

        try{
            const persistence = rememberCheckbox.checked ? window.browserLocalPersistence : window.browserSessionPersistence;
            await window.setPersistence(window.auth, persistence);

            if(isSignUpMode){
                await window.createUserWithEmailAndPassword(window.auth, email, password);
                showToast("Conta criada com sucesso!", 2000);
            } else {
                await window.signInWithEmailAndPassword(window.auth, email, password);
                showToast("Login realizado com sucesso!", 2000);
            }

            setTimeout(() => window.location.href = 'index.html', 2000);
        } catch(error){
            console.error(error.code, error.message);
            if(error.code === 'auth/invalid-email') formError.textContent = 'O e-mail fornecido não é válido.';
            else if(error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') formError.textContent = 'E-mail ou senha incorretos.';
            else if(error.code === 'auth/email-already-in-use') formError.textContent = 'Este e-mail já está em uso.';
            else if(error.code === 'auth/weak-password') formError.textContent = 'A senha deve ter pelo menos 6 caracteres.';
            else formError.textContent = 'Ocorreu um erro. Tente novamente.';
        }
    });
});
</script>

</body>
</html>
